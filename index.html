<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GitHub Image Cloud</title>

<style>
:root {
    --color-canvas-default: #0d1117;
    --color-canvas-subtle: #161b22;
    --color-border-default: #30363d;
    --color-accent-fg: #2f81f7;
    --color-btn-bg: #238636;
    --color-btn-hover: #2ea043;
    --color-fg-default: #c9d1d9;
    --color-fg-muted: #8b949e;
}
body {
    background-color: var(--color-canvas-default);
    color: var(--color-fg-default);
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
    margin: 0;
}
nav {
    background-color: #010409;
    border-bottom: 1px solid var(--color-border-default);
    padding: 12px 32px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.container { max-width: 1100px; margin: auto; padding: 24px; }
.repo-path a { color: var(--color-accent-fg); text-decoration: none; font-weight: 600; }
.box {
    background-color: var(--color-canvas-subtle);
    border: 1px solid var(--color-border-default);
    border-radius: 6px;
    margin-bottom: 24px;
}
.box-header {
    padding: 12px 16px;
    border-bottom: 1px solid var(--color-border-default);
    font-weight: 600;
}
.box-body { padding: 16px; }
input {
    background-color: #0d1117;
    border: 1px solid var(--color-border-default);
    color: white;
    padding: 6px 10px;
    border-radius: 6px;
    margin-bottom: 10px;
    width: 100%;
}
.btn {
    background: #21262d;
    border: 1px solid var(--color-border-default);
    color: white;
    padding: 6px 14px;
    border-radius: 6px;
    cursor: pointer;
}
.btn-primary { background: var(--color-btn-bg); }
.btn-primary:hover { background: var(--color-btn-hover); }
.file-list { border: 1px solid var(--color-border-default); border-radius: 6px; }
.file-item {
    display: flex;
    align-items: center;
    padding: 10px;
    border-bottom: 1px solid var(--color-border-default);
}
.file-item img {
    width: 32px;
    height: 32px;
    object-fit: cover;
    border-radius: 4px;
    margin-right: 12px;
}
#toast {
    position: fixed;
    bottom: 20px;
    right: 20px;
    padding: 12px 20px;
    background: #238636;
    color: white;
    border-radius: 6px;
    display: none;
}
.toast-error { background: #da3633 !important; }
</style>
</head>

<body>

<nav>
    <strong>GitHub Image Cloud</strong>
</nav>

<div class="container">

    <div class="box">
        <div class="box-header">Authentication</div>
        <div class="box-body">
            <input type="password" id="token" placeholder="(TOKEN KEY)">
            <input type="text" id="repo" value="Oceanic19/cloud-notepad-images">
            <input type="text" id="folder" value="images">
        </div>
    </div>

    <div style="margin-bottom:15px;">
        <input type="file" id="fileInput" accept="image/*">
        <button class="btn btn-primary" onclick="uploadImage()">Add Image</button>
        <button class="btn" onclick="fetchImages()">Refresh</button>
    </div>

    <div class="file-list" id="fileList">
        <div style="padding:40px; text-align:center; color:gray;">No images yet</div>
    </div>

</div>

<div id="toast"></div>

<script>
const toast = document.getElementById('toast');
const fileList = document.getElementById('fileList');

function showToast(msg, isError=false){
    toast.innerText = msg;
    toast.className = isError ? "toast-error" : "";
    toast.style.display = "block";
    setTimeout(()=>toast.style.display="none", 4000);
}

async function uploadImage(){
    const fileInput = document.getElementById('fileInput');
    const token = document.getElementById('token').value;
    const repo = document.getElementById('repo').value;
    const folder = document.getElementById('folder').value;

    if(!fileInput.files[0] || !token) return showToast("Missing file or token", true);

    const file = fileInput.files[0];
    const reader = new FileReader();

    reader.onload = async ()=>{
        const base64 = reader.result.split(',')[1];
        const url = `https://api.github.com/repos/${repo}/contents/${folder}/${file.name}`;

        try{
            let sha=null;
            const check = await fetch(url,{headers:{Authorization:`token ${token}`}});
            if(check.ok){ const data = await check.json(); sha=data.sha; }

            const res = await fetch(url,{
                method:"PUT",
                headers:{Authorization:`token ${token}`,"Content-Type":"application/json"},
                body:JSON.stringify({message:`Upload ${file.name}`,content:base64,sha:sha})
            });

            if(!res.ok){ const err=await res.json(); throw new Error(err.message); }

            showToast("Image uploaded!");
            fetchImages();
        }catch(e){ showToast(e.message,true); }
    };
    reader.readAsDataURL(file);
}

async function fetchImages(){
    const token = document.getElementById('token').value;
    const repo = document.getElementById('repo').value;
    const folder = document.getElementById('folder').value;

    if(!token) return showToast("Enter token first", true);

    try{
        const res = await fetch(`https://api.github.com/repos/${repo}/contents/${folder}`,{headers:{Authorization:`token ${token}`}});
        if(!res.ok) throw new Error("Cannot fetch images");

        const files = await res.json();
        let html="";
        files.forEach(file=>{
            html += `
            <div class="file-item">
                <img src="${file.download_url}">
                <div style="flex:1;">${file.name}</div>
                <button class="btn" onclick="deleteImage('${file.name}','${file.sha}')">Delete</button>
            </div>`;
        });
        fileList.innerHTML = html || '<div style="padding:40px;text-align:center;color:gray;">No images</div>';
    }catch(e){ showToast(e.message,true); }
}

async function deleteImage(name, sha){
    const token = document.getElementById('token').value;
    const repo = document.getElementById('repo').value;
    const folder = document.getElementById('folder').value;

    if(!confirm("Delete "+name+"?")) return;

    try{
        const res = await fetch(`https://api.github.com/repos/${repo}/contents/${folder}/${name}`,{
            method:"DELETE",
            headers:{Authorization:`token ${token}`,"Content-Type":"application/json"},
            body:JSON.stringify({message:"Delete image",sha:sha})
        });

        if(!res.ok){ const err=await res.json(); throw new Error(err.message); }

        showToast("Image deleted");
        fetchImages();
    }catch(e){ showToast(e.message,true); }
}
</script>

</body>
</html>



